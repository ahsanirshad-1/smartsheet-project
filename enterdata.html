<!DOCTYPE html>   
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smartsheet Task Board + Automation</title>
  <link rel="stylesheet" href="enterdata.css">
</head>
<body>
  <header class="navbar">
    <h1>üöÄ Smartsheet Task Board</h1>
    <button class="add-btn" onclick="openForm()">‚ûï Add Task</button>
  </header>

  <main class="board">
    <div class="column progress">
      <h2>In Progress</h2>
      <div class="task-list" id="progress"></div>
    </div>

    <div class="column review">
      <h2>In Review</h2>
      <div class="task-list" id="review"></div>
    </div>

    <div class="column done">
      <h2>Done ‚úÖ</h2>
      <div class="task-list" id="done"></div>
    </div>
  </main>

  <!-- Popup Form -->
  <div id="taskForm" class="form-popup">
    <form class="form-container" id="smartsheetForm">
      <h2 id="formTitle">Add Task</h2>

      <label>Task Name</label>
      <input type="text" id="taskname" required>

      <label>Assign To</label>
      <input type="text" id="assign" required>

      <label>Progress</label>
      <select id="progressSelect" required>
        <option value="progress">In Progress</option>
        <option value="review">In Review</option>
        <option value="done">Done</option>
      </select>

      <label>Start Date</label>
      <input type="date" id="startdate" required>

      <label>End Date</label>
      <input type="date" id="enddate" required>

      <button type="submit" id="saveBtn">‚úÖ Save</button>
      <button type="button" class="cancel" onclick="closeForm()">‚ùå Cancel</button>
    </form>
  </div>

  <!-- Automation Section -->
  <section class="automation" style="padding:20px;">
    <h2>‚ö° Automation Rules</h2>
    <ul>
      <li>üîî Reminder 1 day before due date</li>
      <li>‚úÖ Auto-move to Done if end date has passed</li>
    </ul>
  </section>

  <script>
    const tasks = []; 
    let editTask = null;

    // üöÄ Smartsheet Config
    const SHEET_ID = "PfPMx9VG8WqGpQ7wrjWMPPhVPMhjg5j42Q8c2R61"; 
    const API_TOKEN = "YOUR_ACCESS_TOKEN_HERE"; // Replace with your Smartsheet API token

    // Replace with actual Smartsheet column IDs
    const COL_TASKNAME = 4119394258734980;  
    const COL_ASSIGN   = 1234567891;  
    const COL_START    = 1234567892;  
    const COL_END      = 1234567893;  
    const COL_PROGRESS = 1234567894;  

    // --- UI Functions ---
    function openForm(taskObj = null) {
      document.getElementById("taskForm").style.display = "block";

      if (taskObj) {
        // Editing mode
        document.getElementById("formTitle").innerText = "Update Task";
        document.getElementById("saveBtn").innerText = "‚úèÔ∏è Update";

        document.getElementById("taskname").value = taskObj.name;
        document.getElementById("assign").value = taskObj.assign;
        document.getElementById("progressSelect").value = taskObj.status;
        document.getElementById("startdate").value = taskObj.start;
        document.getElementById("enddate").value = taskObj.end;

        editTask = taskObj;
      } else {
        // Adding mode
        document.getElementById("smartsheetForm").reset();
        document.getElementById("formTitle").innerText = "Add Task";
        document.getElementById("saveBtn").innerText = "‚úÖ Save";
        editTask = null;
      }
    }

    function closeForm() {
      document.getElementById("taskForm").style.display = "none";
      document.getElementById("smartsheetForm").reset();
      editTask = null;
    }

    function createTaskCard(taskObj) {
      const taskCard = document.createElement("div");
      taskCard.className = "task-card";
      taskCard.innerHTML = `
        <h3>${taskObj.name}</h3>
        <p>üë§ ${taskObj.assign}</p>
        <p>üìÖ ${taskObj.start} ‚ûù ${taskObj.end}</p>
        <button onclick="openForm(tasks.find(t => t.id === '${taskObj.id}'))">‚úèÔ∏è Edit</button>
      `;
      return taskCard;
    }

    // --- API Functions ---
    async function loadTasks() {
      const response = await fetch(`https://api.smartsheet.com/2.0/sheets/${SHEET_ID}`, {
        headers: { "Authorization": "Bearer " + API_TOKEN }
      });
      const data = await response.json();
      console.log("Full sheet data:", data);

      data.rows.forEach(row => {
        const taskObj = {
          id: row.id, // ‚úÖ save Smartsheet row ID
          name: row.cells.find(c => c.columnId === COL_TASKNAME)?.value || "Untitled",
          assign: row.cells.find(c => c.columnId === COL_ASSIGN)?.value || "Unknown",
          start: row.cells.find(c => c.columnId === COL_START)?.value || "",
          end: row.cells.find(c => c.columnId === COL_END)?.value || "",
          status: row.cells.find(c => c.columnId === COL_PROGRESS)?.value?.toLowerCase() || "progress",
          element: null
        };

        const taskCard = createTaskCard(taskObj);
        taskObj.element = taskCard;
        document.getElementById(taskObj.status).appendChild(taskCard);
        tasks.push(taskObj);
      });
    }

    async function saveTaskToSmartsheet(taskObj) {
      const newRow = {
        toTop: true,
        cells: [
          { columnId: COL_TASKNAME, value: taskObj.name },
          { columnId: COL_ASSIGN, value: taskObj.assign },
          { columnId: COL_START, value: taskObj.start },
          { columnId: COL_END, value: taskObj.end },
          { columnId: COL_PROGRESS, value: taskObj.status }
        ]
      };

      await fetch(`https://api.smartsheet.com/2.0/sheets/${SHEET_ID}/rows`, {
        method: "POST",
        headers: {
          "Authorization": "Bearer " + API_TOKEN,
          "Content-Type": "application/json"
        },
        body: JSON.stringify([newRow])
      });
    }

    async function updateTaskInSmartsheet(taskObj) {
      const updateRow = {
        id: taskObj.id,
        cells: [
          { columnId: COL_TASKNAME, value: taskObj.name },
          { columnId: COL_ASSIGN, value: taskObj.assign },
          { columnId: COL_START, value: taskObj.start },
          { columnId: COL_END, value: taskObj.end },
          { columnId: COL_PROGRESS, value: taskObj.status }
        ]
      };

      await fetch(`https://api.smartsheet.com/2.0/sheets/${SHEET_ID}/rows`, {
        method: "PUT",
        headers: {
          "Authorization": "Bearer " + API_TOKEN,
          "Content-Type": "application/json"
        },
        body: JSON.stringify([updateRow])
      });
    }

    // --- Form Handler ---
    document.getElementById("smartsheetForm").addEventListener("submit", async function(e) {
      e.preventDefault();

      if (editTask) {
        // Update existing
        editTask.name = document.getElementById("taskname").value;
        editTask.assign = document.getElementById("assign").value;
        editTask.start = document.getElementById("startdate").value;
        editTask.end = document.getElementById("enddate").value;
        editTask.status = document.getElementById("progressSelect").value;

        // Refresh UI
        editTask.element.remove();
        const updatedCard = createTaskCard(editTask);
        editTask.element = updatedCard;
        document.getElementById(editTask.status).appendChild(updatedCard);

        await updateTaskInSmartsheet(editTask);
      } else {
        // Add new
        const taskObj = {
          id: Date.now().toString(), // temporary ID until reload
          name: document.getElementById("taskname").value,
          assign: document.getElementById("assign").value,
          start: document.getElementById("startdate").value,
          end: document.getElementById("enddate").value,
          status: document.getElementById("progressSelect").value,
          element: null
        };

        const taskCard = createTaskCard(taskObj);
        taskObj.element = taskCard;
        document.getElementById(taskObj.status).appendChild(taskCard);
        tasks.push(taskObj);

        await saveTaskToSmartsheet(taskObj);
      }

      closeForm();
    });

    // --- Load tasks on page start ---
    window.onload = loadTasks;
  </script>
</body>
</html>






